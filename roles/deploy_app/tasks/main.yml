---
# tasks file for deploy_app
- name: Adding volume for mongodb config
  ansible.builtin.file:
    path: /opt/apps/mongodb/configdb
    mode: "0644"
    state: directory
    owner: root
    group: root

- name: Adding volume for mongodb data
  ansible.builtin.file:
    path: /opt/apps/mongodb/db
    mode: "0644"
    state: directory
    owner: root
    group: root

- name: Adding volume for mongodb data
  ansible.builtin.file:
    path: /opt/todos
    mode: "0644"
    state: directory
    owner: root
    group: root

- name: Add compose file
  ansible.builtin.copy:
    src: docker-compose.yaml
    dest: /opt/todos/docker-compose.yaml
    mode: "0644"
    owner: root
    group: root

- name: Run New Image
  community.docker.docker_compose_v2:
    project_src: /opt/todos
    project_name: todos
    state: present
    pull: missing

  register: app_deployment_result

- name: App deployment
  ansible.builtin.debug:
    var: app_deployment_result
